/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

let dropdownStyles=require("./dropdown.styles"),GSC_DROPDOWN_CONSTANTS=require("./constants").GSC_DROPDOWN_CONSTANTS,stylesInjected=!1;class Dropdown{constructor(e,t,i){e?(this.container=e,this.config={scrollableMenuThreshold:7,scrollableMenuText:"Scroll down for more...",...t},this.onChangeCallback=i,this.selectedOption=null,this.previousValue=void 0,this.elements={},this.isOpen=!1,Array.isArray(this.config.options)&&0!==this.config.options.length||(console.warn("Dropdown initialized with no options."),this.config.options=[]),this.init()):console.error("Dropdown requires a container element.")}init(){this.injectStyles(),this.render(),this.bindEvents(),this.setInitialValue()}injectStyles(){var e;stylesInjected||((e=document.createElement("style")).textContent=dropdownStyles,document.head.appendChild(e),stylesInjected=!0)}render(){this.container.innerHTML="",this.container.classList.add(GSC_DROPDOWN_CONSTANTS.CONTAINER_CLASS),this.config.label&&((e=document.createElement("span")).classList.add(GSC_DROPDOWN_CONSTANTS.LABEL_CLASS),e.textContent=this.config.label,this.elements.label=e,this.container.appendChild(e));var e=document.createElement("div"),t=(e.classList.add(GSC_DROPDOWN_CONSTANTS.DISPLAY_CLASS),e.setAttribute("role",GSC_DROPDOWN_CONSTANTS.ARIA_ROLE_COMBOBOX),e.setAttribute("aria-haspopup",GSC_DROPDOWN_CONSTANTS.ARIA_HASPOPUP_LISTBOX),e.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_EXPANDED,"false"),e.setAttribute("tabindex","0"),this.elements.display=e,void 0!==this.config.displayFontSize&&(this.elements.display.style.fontSize=this.config.displayFontSize),void 0!==this.config.displayFontWeight&&(this.elements.display.style.fontWeight=this.config.displayFontWeight),void 0!==this.config.displayBorder&&(this.elements.display.style.border=this.config.displayBorder),void 0!==this.config.displayBackgroundColor&&(this.elements.display.style.backgroundColor=this.config.displayBackgroundColor),void 0!==this.config.displayPadding&&(this.elements.display.style.padding=this.config.displayPadding),document.createElement("span")),t=(t.classList.add(GSC_DROPDOWN_CONSTANTS.SELECTED_TEXT_CLASS),this.elements.selectedText=t,e.appendChild(t),document.createElement("span"));t.classList.add(GSC_DROPDOWN_CONSTANTS.CARET_CLASS),this.config.caretIconSVG?(t.classList.add(GSC_DROPDOWN_CONSTANTS.CARET_SVG_CLASS),t.innerHTML=this.config.caretIconSVG):t.textContent="â–¼",this.elements.caret=t,e.appendChild(t),this.container.appendChild(e);let i=document.createElement("ul");i.classList.add(GSC_DROPDOWN_CONSTANTS.OPTIONS_LIST_CLASS),i.setAttribute("role",GSC_DROPDOWN_CONSTANTS.ARIA_ROLE_LISTBOX),i.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_HIDDEN,"true"),i.style.marginTop="5px",i.style.padding="7px";t="gsc-dropdown-list-"+Math.random().toString(36).substr(2,9);i.id=t,e.setAttribute("aria-controls",t),this.config.options.length>=this.config.scrollableMenuThreshold&&((e=document.createElement("li")).classList.add("gsc-dropdown-scrollable-header"),e.textContent=this.config.scrollableMenuText,i.appendChild(e)),this.elements.optionsList=i,this.config.options.forEach(e=>{var t=document.createElement("li");t.classList.add(GSC_DROPDOWN_CONSTANTS.OPTION_CLASS),t.setAttribute("role",GSC_DROPDOWN_CONSTANTS.ARIA_ROLE_OPTION),t.setAttribute(GSC_DROPDOWN_CONSTANTS.DATA_VALUE,e.value),t.textContent=e.text,i.appendChild(t)}),this.container.appendChild(i)}bindEvents(){this.elements.display.addEventListener("click",this.handleDisplayClick.bind(this)),this.elements.optionsList.addEventListener("click",this.handleOptionClick.bind(this)),document.addEventListener("click",this.handleDocumentClick.bind(this)),this.elements.display.addEventListener("keydown",this.handleKeyDown.bind(this)),this.elements.optionsList.addEventListener("keydown",this.handleKeyDown.bind(this))}handleDisplayClick(){this.toggleDropdown()}handleOptionClick(e){var e=e.target;e.classList.contains(GSC_DROPDOWN_CONSTANTS.OPTION_CLASS)&&(e=e.getAttribute(GSC_DROPDOWN_CONSTANTS.DATA_VALUE),this.setValue(e))}handleDocumentClick(e){this.isOpen&&!this.container.contains(e.target)&&this.closeDropdown()}handleKeyDown(e){var t,i=e.key,s=Array.from(this.elements.optionsList.children).filter(e=>e.classList.contains(GSC_DROPDOWN_CONSTANTS.OPTION_CLASS)),n=s.findIndex(e=>e===document.activeElement);switch(i){case"Enter":case" ":e.preventDefault(),this.isOpen&&-1!==n?s[n].click():this.isOpen||this.openDropdown();break;case"Escape":this.isOpen&&(e.preventDefault(),this.closeDropdown(),this.elements.display.focus());break;case"ArrowDown":e.preventDefault(),this.isOpen?s[t=n<s.length-1?n+1:s.length-1]&&s[t].focus():(this.openDropdown(),t=this.selectedOption?s.findIndex(e=>e.getAttribute(GSC_DROPDOWN_CONSTANTS.DATA_VALUE)===this.selectedOption.value):0,s[t]&&s[t].focus());break;case"ArrowUp":e.preventDefault(),this.isOpen&&s[t=0<n?n-1:0]&&s[t].focus();break;case"Tab":this.isOpen&&this.closeDropdown()}}toggleDropdown(){this.isOpen?this.closeDropdown():this.openDropdown()}openDropdown(){var e;0!==this.config.options.length&&(this.isOpen=!0,this.container.classList.add(GSC_DROPDOWN_CONSTANTS.OPEN_CLASS),this.elements.optionsList.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_HIDDEN,"false"),this.elements.display.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_EXPANDED,"true"),this.selectedOption?(e=this.elements.optionsList.querySelector(`[${GSC_DROPDOWN_CONSTANTS.DATA_VALUE}="${this.selectedOption.value}"]`))&&e.focus():(e=this.elements.optionsList.querySelector("."+GSC_DROPDOWN_CONSTANTS.OPTION_CLASS))&&e.focus())}closeDropdown(){this.isOpen=!1,this.container.classList.remove(GSC_DROPDOWN_CONSTANTS.OPEN_CLASS),this.elements.optionsList.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_HIDDEN,"true"),this.elements.display.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_EXPANDED,"false"),document.activeElement&&this.elements.optionsList.contains(document.activeElement)&&this.elements.display.focus()}setInitialValue(){var e;void 0!==this.config.initialValue?(e=this.config.options.find(e=>e.value===this.config.initialValue))?this.setValue(e.value,!1):(console.warn(`Dropdown: initialValue "${this.config.initialValue}" not found in options.`),this.handleNoInitialValue()):this.handleNoInitialValue()}handleNoInitialValue(){0<this.config.options.length?this.setValue(this.config.options[0].value,!1):(this.elements.selectedText.textContent="No options available",this.selectedOption=null,this.previousValue=void 0,this.elements.display.setAttribute("aria-disabled","true"),this.elements.display.removeAttribute("tabindex"))}setValue(t,e=!0){var i,s=this.config.options.find(e=>e.value===t);s?((i=this.selectedOption?this.selectedOption.value:void 0)!==t&&(this.previousValue=i,this.selectedOption=s,this.elements.selectedText.textContent=s.text,Array.from(this.elements.optionsList.children).forEach(e=>{e.getAttribute(GSC_DROPDOWN_CONSTANTS.DATA_VALUE)===t?e.setAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_SELECTED,"true"):e.removeAttribute(GSC_DROPDOWN_CONSTANTS.ARIA_SELECTED)}),e)&&"function"==typeof this.onChangeCallback&&this.onChangeCallback(this.selectedOption.value,this.previousValue),this.closeDropdown()):console.warn(`Dropdown: Attempted to set value "${t}" which was not found in options.`)}getValue(){return this.selectedOption?this.selectedOption.value:void 0}getText(){return this.selectedOption?this.selectedOption.text:void 0}destroy(){this.elements.display.removeEventListener("click",this.handleDisplayClick.bind(this)),this.elements.optionsList.removeEventListener("click",this.handleOptionClick.bind(this)),document.removeEventListener("click",this.handleDocumentClick.bind(this)),this.elements.display.removeEventListener("keydown",this.handleKeyDown.bind(this)),this.elements.optionsList.removeEventListener("keydown",this.handleKeyDown.bind(this)),this.elements={},this.selectedOption=null,this.previousValue=void 0,this.isOpen=!1}}module.exports={Dropdown:Dropdown};
