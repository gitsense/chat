/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

let tableStyles=require("./table.styles"),GSC_TABLE_CONSTANTS=require("./constants").GSC_TABLE_CONSTANTS,stylesInjected=!1;class Table{constructor(e,t){if(!e)throw new Error("Table component requires a parent DOM element.");if(!Array.isArray(t.columns)||0===t.columns.length)throw new Error("Table component requires at least one column definition.");this.parentElement=e,this.config={options:{maxBodyHeight:GSC_TABLE_CONSTANTS.DEFAULT_MAX_BODY_HEIGHT,emptyMessage:GSC_TABLE_CONSTANTS.DEFAULT_EMPTY_MESSAGE,...t.options},...t},this.config.options.scrollbarWidth||(this.config.options.scrollbarWidth=GSC_TABLE_CONSTANTS.DEFAULT_SCROLLBAR_WIDTH),this.autoColumnIndex=-1,this.calculatedColumnWidths=[],this.elements={},this.init()}init(){this._injectStyles(),this._validateColumnDefinitions(),this._renderInitialStructure(),this._calculateAndApplyColumnWidths()}_injectStyles(){var e;stylesInjected||((e=document.createElement("style")).textContent=tableStyles,document.head.appendChild(e),stylesInjected=!0)}_renderInitialStructure(){this.elements.wrapper=document.createElement("div"),this.elements.wrapper.classList.add(GSC_TABLE_CONSTANTS.TABLE_WRAPPER_CLASS),this.elements.wrapper.style.setProperty("--gsc-table-body-max-height",this.config.options.maxBodyHeight),this.elements.wrapper.style.setProperty("--gsc-scrollbar-width",this.config.options.scrollbarWidth),this.elements.table=document.createElement("table"),this.elements.table.classList.add(GSC_TABLE_CONSTANTS.TABLE_CLASS),this.elements.table.style.margin="0px",this.elements.wrapper.appendChild(this.elements.table),this.elements.thead=document.createElement("thead"),this.elements.thead.classList.add(GSC_TABLE_CONSTANTS.TABLE_HEADER_CLASS),this.elements.table.appendChild(this.elements.thead),this.elements.tbody=document.createElement("tbody"),this.elements.tbody.classList.add(GSC_TABLE_CONSTANTS.TABLE_BODY_CLASS),this.elements.table.appendChild(this.elements.tbody);let s=document.createElement("tr");this.config.columns.forEach(e=>{var t=document.createElement("th");"string"==typeof e.header?t.textContent=e.header:e.header instanceof HTMLElement&&t.appendChild(e.header),e.textAlign&&(t.style.textAlign=e.textAlign),s.appendChild(t)}),this.elements.thead.appendChild(s),this.parentElement.appendChild(this.elements.wrapper),this._displayEmptyMessage()}_validateColumnDefinitions(){let s=0;if(this.config.columns.forEach((e,t)=>{if(!e.width)throw new Error(`Column '${e.id}' must have a 'width' property specified as an integer (e.g., '100px') or '${GSC_TABLE_CONSTANTS.AUTO_WIDTH_KEYWORD}'.`);if(e.width===GSC_TABLE_CONSTANTS.AUTO_WIDTH_KEYWORD)s++,this.autoColumnIndex=t;else if(!e.width.match(/^(\d+)px$/))throw new Error(`Column '${e.id}' has an invalid 'width' value '${e.width}'. Must be an integer (e.g., '100px') or '${GSC_TABLE_CONSTANTS.AUTO_WIDTH_KEYWORD}'.`)}),1<s)throw new Error(`Only one column can have '${GSC_TABLE_CONSTANTS.AUTO_WIDTH_KEYWORD}' width.`)}_calculateAndApplyColumnWidths(){if(this.elements.wrapper&&this.elements.wrapper.offsetParent){var t=this.elements.wrapper.clientWidth-parseInt(this.config.options.scrollbarWidth,10);let s=0;if(this.calculatedColumnWidths=this.config.columns.map((e,t)=>e.width===GSC_TABLE_CONSTANTS.AUTO_WIDTH_KEYWORD?0:(e=parseInt(e.width,10),s+=e,e)),-1!==this.autoColumnIndex){let e=t-s;e<0&&(console.warn("Calculated auto column width is negative. Adjusting to 0."),e=0),this.calculatedColumnWidths[this.autoColumnIndex]=e}let n=this.elements.thead.querySelector("tr").children;this.calculatedColumnWidths.forEach((e,t)=>{n[t].style.width=e+"px"})}else console.warn("Table wrapper not in DOM yet, cannot calculate column widths.")}addRow(n){this.elements.emptyMessageRow&&(this.elements.emptyMessageRow.remove(),this.elements.emptyMessageRow=null);let i=document.createElement("tr");this.config.columns.forEach((e,t)=>{var s=document.createElement("td");s.style.width=this.calculatedColumnWidths[t]+"px",e.renderCell&&"function"==typeof e.renderCell?"string"==typeof(t=e.renderCell(n,e.id))?s.textContent=t:t instanceof HTMLElement&&s.appendChild(t):s.textContent=void 0!==n[e.id]?n[e.id]:"",e.textAlign&&(s.style.textAlign=e.textAlign),e.verticalAlign&&(s.style.verticalAlign=e.verticalAlign),e.whiteSpace&&(s.style.whiteSpace=e.whiteSpace),i.appendChild(s)}),this.elements.tbody.appendChild(i)}addRows(e){Array.isArray(e)?(e.forEach(e=>this.addRow(e)),this._updateEmptyMessageVisibility()):console.error("addRows expects an array of data objects.")}clearRows(){this.elements.tbody.innerHTML="",this._displayEmptyMessage()}updateData(e){this.clearRows(),this.addRows(e)}_displayEmptyMessage(){var e;0!==this.elements.tbody.children.length||this.elements.emptyMessageRow||(this.elements.emptyMessageRow=document.createElement("tr"),this.elements.emptyMessageRow.classList.add(GSC_TABLE_CONSTANTS.TABLE_EMPTY_MESSAGE_CLASS),(e=document.createElement("td")).setAttribute("colspan",this.config.columns.length),e.textContent=this.config.options.emptyMessage,this.elements.emptyMessageRow.appendChild(e),this.elements.tbody.appendChild(this.elements.emptyMessageRow))}_updateEmptyMessageVisibility(){0<this.elements.tbody.children.length&&this.elements.emptyMessageRow?(this.elements.emptyMessageRow.remove(),this.elements.emptyMessageRow=null):0!==this.elements.tbody.children.length||this.elements.emptyMessageRow||this._displayEmptyMessage()}cleanup(){this.elements.wrapper&&this.elements.wrapper.parentElement&&this.elements.wrapper.remove(),this.elements={}}}module.exports={Table:Table};
