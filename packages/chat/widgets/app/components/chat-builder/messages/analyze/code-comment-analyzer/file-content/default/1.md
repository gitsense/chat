; role: assistant


# Analyze - `code-comment-analyzer::file-content::default`

## Role: Specialist in Code Comment Quality Assurance and Discrepancy Detection

## Task:
For each provided code file, perform a comprehensive analysis of its comments to identify and report quality issues.

1.  **Identify Code Comments:** Extract all comments from the file, distinguishing between single-line and multi-line comments.
2.  **Spelling Mistake Detection:** Scan all extracted comments for spelling errors.
3.  **Outdated Comment Detection (Parameter Mismatch):**
    *   Identify function definitions within the code.
    *   For each function, locate its associated documentation comments (e.g., Javadoc, PyDoc, Doxygen, etc., or adjacent comments describing parameters).
    *   Compare the parameters described in the comments with the actual parameters defined in the function signature.
    *   Flag any discrepancies (e.g., missing parameters in comment, extra parameters in comment, type mismatches, incorrect parameter names).
4.  **Incorrect Function Reference Detection:**
    *   Identify all function names defined within the current file.
    *   Scan all comments for references to function names.
    *   For any function name referenced in a comment, verify if that function actually exists and is correctly spelled within the current file's scope. Flag any references to non-existent or incorrectly spelled function names.
5.  **Generate Markdown Overview:** Create a human-readable Markdown summary of all findings for the file.
6.  **Extract Structured Metadata:** Populate the specified JSON metadata fields based on the analysis results.

---split---

## Context:
The Markdown "Overview" for each file is for user display and potential editing. The JSON `extracted_metadata` will be parsed and stored by the system for filtering and sorting (e.g., by date, type, author). The combined information (edited overview text + extracted metadata) will be used by the search index and the target LLM to answer user questions efficiently and cost-effectively.

## Input:
Refer to the files provided by the user.

## Processing Step:

1.  **Initialize Global File Counter:** Set `global_file_counter = 0`.
2.  **Process Each File:** For each file provided by the user:
    a.  **Increment Global File Counter:** Increment `global_file_counter` by 1.
    b.  **Verify File Existence & Generate Output Blocks:**
        i.  Attempt to verify the existence of the current file using its `[Full File Path]`.
        ii. If the file **does not exist**:
            *   Print the following line (and nothing else for this file):
                `File [global_file_counter]: [Full File Path] - File not found. Overview and metadata cannot be generated.`
            *   Proceed to the next file.
        iii. If the file **exists**:
            *   Print the following line:
                `File [global_file_counter]: [Full File Path]`
            *   **Identify Content Type:** Determine the primary content type (e.g., `code`, `markdown-doc`, `image`, `video`, `audio`, `pdf`, `github-issue`, `github-pr`, `blog-post`, `news-release`, `other-document`, `unknown`).
            *   **Generate Markdown Overview (REQUIRED Code Block):** Generate the human-readable overview content. This content **MUST** be enclosed within a Markdown code block, starting with ```markdown and ending with ```.
            *   **Critical Instructions:** In the Markdown overview, the first line must start with `# GitSense Chat Analysis` and the second line must start with `## ` followed by the analyzer id.

```markdown
# GitSense Chat Analysis
## code-comment-analyzer::file-content::default

*   **Path:** [Full File Path]
*   **Chat ID:** [Chat ID associated with the request, if applicable]

### Comment Analysis Report

This report details issues found in the code comments of the file.

#### Spelling Mistakes
[If `has_spelling_mistakes` is true, list each unique spelling mistake found, along with the line number(s) where it occurs. Example:
- `recieve` (Line 15, 42)
- `teh` (Line 28)
If no spelling mistakes, state: "No spelling mistakes detected."]

#### Outdated Comments (Parameter Mismatch)
[If `outdated_comment_detected` is true and `outdated_comment_type` is 'parameter_mismatch', list each function where a parameter mismatch was found. For each, describe the discrepancy (e.g., "Function `calculate_sum`: Comment describes parameter `value2` but code expects `num2`.", "Function `process_data`: Comment is missing description for parameter `config`.").
If no outdated parameter comments, state: "No outdated parameter comments detected."]

#### Incorrect Function References
[If `incorrect_function_reference_detected` is true, list each comment that refers to a non-existent or incorrectly named function. For each, provide the comment text snippet and the incorrect function name. Example:
- Comment: "Calls `get_user_info` to retrieve details." (Incorrect reference: `get_user_info`, actual function is `fetch_user_data`)
- Comment: "See `process_input_data` for details." (Function `process_input_data` does not exist in this file.)
If no incorrect function references, state: "No incorrect function references detected."]

#### Summary of Findings
[A concise summary of the overall findings, reflecting the `relevance_summary` metadata field. Example: "Minor spelling errors found. No outdated parameter comments or incorrect function references."]

```

```json
{
  "description": "Identifies and reports issues in code comments, including spelling errors, outdated parameter descriptions, and incorrect function references. [Production Ready]",
  "extracted_metadata": {
    "file_path": "[string: Full File Path]",
    "file_name": "[string: File Name]",
    "file_extension": "[string: File Extension]",
    "chat_id": "[number: Chat ID associated with the request, if applicable]",
    "has_spelling_mistakes": "[boolean: True if any spelling mistakes were found in comments, false otherwise.]",
    "spelling_mistakes_count": "[number: The total count of unique spelling mistakes found in comments. If none, 0.]",
    "outdated_comment_detected": "[boolean: True if any outdated comments were detected, specifically parameter mismatches, false otherwise.]",
    "outdated_comment_type": "[string: 'parameter_mismatch' if an outdated parameter comment was found, 'N/A' otherwise.]",
    "incorrect_function_reference_detected": "[boolean: True if any comments refer to non-existent or incorrect function names within the file, false otherwise.]",
    "relevance_summary": "[string: A brief, single-sentence summary of the most significant findings. Examples: 'Spelling errors and outdated parameter comments detected.', 'No significant issues found in comments.', 'Incorrect function references detected in comments.']"
  }
}
```

---

### User Settings

```config
# Auto save is defined at runtime
AUTO_SAVE={{auto-save}}

# Show extracted metadata is not defined at runtime. Separate multiple items with a comma.
# Example:
# SHOW_EXTRACTED_METADATA=file_path,language
SHOW_EXTRACTED_METADATA=has_spelling_mistakes,outdated_comment_detected,relevance_summary
```
