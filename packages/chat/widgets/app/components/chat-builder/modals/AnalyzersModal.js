/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

let{h,svg}=require("../Dependencies"),NewChatModal=require("./NewChatModal");function AnalyzersModal(e,t,n,a,l={}){let{onClose:u,onNewAnalyzer:y,onDeleteAnalyzer:x}=l;var{}=t;let d=null,m=e;function i(){let a=this,l=null,i=null,d=null,r=null,t=!1;function s(e,a=null){if(d)if(d.innerHTML="","default"===e){var t=h.createButton({cls:"btn btn-primary",text:"New Analyzer",style:{marginRight:"5px"}}),l=(t.onclick=()=>{y&&y()},h.createButton({cls:"btn",text:"Close",style:{marginRight:"5px"}}));l.onclick=g,d.append(l,t)}else if("confirm-delete"===e&&a){let e=a.split("::")[0],t=h.createInput({cls:"form-control",placeholder:`Type "${e}" to confirm deletion`,style:{flexGrow:1,marginRight:"10px",padding:"8px",minWidth:"450px"}}),n=h.createButton({cls:"btn btn-danger disabled",text:"Delete",style:{marginRight:"5px"}});l=h.createButton({cls:"btn",text:"Cancel",style:{marginRight:"5px"}});t.onkeyup=()=>{t.value===e?n.classList.remove("disabled"):n.classList.add("disabled")},n.onclick=()=>{!n.classList.contains("disabled")&&x&&(x(a),s("default"))},l.onclick=()=>{s("default")},d.append(t,l,n)}}function o(){t=!1}function c(){t=!0}function p(e){e.target!==l||t||0!==window.getSelection().toString().length||g(),t=!1}function g(){u&&u()}this.destroy=()=>{l&&l.parentNode&&l.parentNode.removeChild(l),document.removeEventListener("mousedown",o),document.removeEventListener("mousemove",c),window.removeEventListener("click",p)},this.render=()=>{var e,t,n;e=h.createSpan({append:[svg.x()],style:{cursor:"pointer"}}),t=h.createDiv({cls:"gs-chat-modal-header",append:[h.createH2({text:"Analyzers"}),e]}),n=h.createThead({append:[h.createTr({append:[h.createTh({text:"Name",style:{textAlign:"left"}}),h.createTh({text:"Content Type",style:{textAlign:"left",width:"150px"}}),h.createTh({text:"Instructions",style:{textAlign:"left",width:"150px"}}),h.createTh({text:"",style:{width:"30px"}})]})]}),i=h.createTbody({style:{fontSize:".9em"}}),n=h.createTable({cls:"gs-chat-table",append:[n,i],style:{width:"100%",borderCollapse:"collapse",marginTop:"15px"}}),r=h.createDiv({cls:"gs-chat-error-message",style:{color:"#dc3545",textAlign:"center",marginTop:"15px",display:"none"}}),n=h.createDiv({cls:"gs-chat-modal-body",append:[n,r],style:{padding:"20px",minHeight:"15vh",maxHeight:"60vh",overflowY:"auto"}}),d=h.createDiv({cls:"gs-chat-modal-footer",style:{justifyContent:"flex-end"}}),t=h.createDiv({cls:"gs-chat-modal-content",append:[t,n,d],style:{width:"750px",maxWidth:"90%",minHeight:"300px"}}),l=h.createDiv({cls:"gs-chat-modal",append:[t],style:{zIndex:100000002}}),document.body.appendChild(l),e.onclick=g,document.addEventListener("mousedown",o),document.addEventListener("mousemove",c),window.addEventListener("click",p),a.updateTable(m),s("default")},this.updateTable=e=>{i&&(i.innerHTML="",e&&0!==e.length?e.forEach((t,e)=>{var n=t.id.split("::"),a=n[0]||"",l=n[1]||"",n=n[2]||"";let d;t.protected?d=h.createSpan({append:[svg.shieldLock()],style:{display:"inline-block",verticalAlign:"middle",marginLeft:"5px",color:"#6c757d"}}):(d=h.createSpan({append:[svg.trash()],style:{cursor:"pointer",display:"inline-block",verticalAlign:"middle",marginLeft:"5px"}})).onclick=e=>{e.stopPropagation(),s("confirm-delete",t.id),r.style.display="none"};e=0===e?"15px":null,a=h.createTr({append:[h.createTd({text:a,style:{width:"auto",paddingTop:e}}),h.createTd({text:l,style:{width:"150px",paddingTop:e}}),h.createTd({text:n,style:{width:"200px"},paddingTop:e}),h.createTd({append:[d],style:{width:"30px",textAlign:"center",paddingTop:e}})]});i.appendChild(a)}):(e=h.createTr({append:[h.createTd({text:"No analyzers available.",attributes:{colspan:4},style:{textAlign:"center",padding:"20px"}})]}),i.appendChild(e)))},this.updateErrorMessage=e=>{r.style.display=null,r.innerText=e}}this.render=()=>{(d=new i).render()},this.destroy=()=>{d&&d.destroy()},this.updateAnalyzers=e=>{m=e,d&&d.updateTable&&d.updateTable(m),d&&d.updateErrorMessage&&d.updateErrorMessage("")},this.updateErrorMessage=e=>{d?.updateErrorMessage(e)}}module.exports=AnalyzersModal;
