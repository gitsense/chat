/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

let svg=require("../Dependencies").svg,DomUtils=require("../utils/DomUtils"),ScrollUtils=require("../utils/ScrollUtils"),MessagePositionIndicator=require("./MessageDashboard/components/MessagePositionIndicator");function ConversationControlPanel(t={},e={},o={}){let{dockingTopOffset:l=100,zIndex:s=10,showFoldAllMessages:n=!0,showFoldAllCode:d=!0,showScrollControls:i=!0,showMessagePosition:a=!0,buttonWidth:r=40,buttonLabels:p={foldMessages:"FM",unfoldMessages:"UM",foldCode:"FC",unfoldCode:"UC",scrollTop:"↑",scrollBottom:"↓"},fullButtonLabels:g={foldMessages:"Fold Messages",unfoldMessages:"Unfold Messages",foldCode:"Fold Code",unfoldCode:"UC",scrollTop:"↑ Top",scrollBottom:"↓ Bottom"},positionIndicatorOptions:c={labelText:"Messages",updateInterval:100,visibilityThreshold:.5,minWidth:40}}=t;var{}=e;let{onFoldAllMessages:u,onUnfoldAllMessages:f,onFoldAllCode:h,onUnfoldAllCode:x,onScrollToTop:m,onScrollToBottom:y,onOpenMessageToolsModal:C}=o,T=null,v=!1,M=[],b=null,w=null,D=null,B=null,U=null;function R(e,o,t,l){let s=DomUtils.h.createButton({text:o,cls:"gs-nav-button",style:{fontSize:"13px",padding:"4px 8px",margin:"4px",backgroundColor:"white",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",transition:"all 0.2s ease",color:"#333",textAlign:"center",whiteSpace:"nowrap",width:"100%"}});return s.dataset.shortText=e,s.dataset.fullText=o,l&&(s.title=l),s.addEventListener("mouseover",()=>{s.style.backgroundColor="#e0e0e0"}),s.addEventListener("mouseout",()=>{s.style.backgroundColor="white"}),s.addEventListener("click",e=>(e.preventDefault(),e.stopPropagation(),t&&t(e),!1)),M.push(s),s}function S(o){M.forEach(e=>{o?(e.textContent=e.dataset.shortText,e.style.width=r+"px",e.style.margin="4px 0"):(e.style.width=null,e.textContent=e.dataset.fullText,e.style.margin="4px")})}function A(){let o=T.offsetTop;window.addEventListener("scroll",()=>{var e=window.scrollY>o-l;if(e!==v){if(v=e)T.classList.add("docked"),T.style.position="fixed",T.style.top=l+"px",T.style.left="20px",T.style.zIndex=s,T.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)",T.style.padding="8px",T.style.borderRadius="0 4px 4px 0",T.style.border="1px solid #ccc",T.style.backgroundColor="rgba(255, 255, 255, 0.95)",T.style.maxWidth=r+24+"px",T.style.flexDirection="column",T.style.alignItems="center",[w,D,B,U].forEach((e,o)=>{e&&(e.style.flexDirection="column",e.style.width="100%",e.style.marginRight="0",e.style.borderRight="none",e.style.paddingRight="0",e.style.borderBottom="1px solid #ddd",e.style.paddingBottom="8px",e.style.marginBottom="8px")}),S(!0);else{T.classList.remove("docked"),T.style.position="static",T.style.boxShadow="none",T.style.padding="8px 0",T.style.border="none",T.style.borderRadius="0",T.style.maxWidth="none",T.style.flexDirection="row",T.style.alignItems="center";let t=[w,D,B,U];t.forEach((e,o)=>{e&&(e.style.flexDirection="row",e.style.width="auto",o=o===t.length-1||!t[o+1],e.style.marginRight=o?"0":"6px",e.style.borderRight=o?"none":"1px solid #ddd",e.style.paddingRight=o?"0":"6px",e.style.borderBottom="none",e.style.paddingBottom="0",e.style.marginBottom="0")}),S(!1)}b&&b.updateDockingState(v)}})}return{render:function(o){var e,t;if(o)return M=[],T=DomUtils.h.createDiv({cls:"gs-conversation-control-panel",style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"8px 0",transition:"all 0.2s ease-in-out",backgroundColor:"white",marginTop:"15px",marginBottom:"16px",fontSize:"13px"}}),w=DomUtils.h.createDiv({cls:"gs-nav-group",id:"message-controls-group",style:{display:"flex",flexDirection:"row",marginRight:"6px",borderRight:"1px solid #ddd",paddingRight:"6px"}}),D=DomUtils.h.createDiv({cls:"gs-nav-group",id:"code-controls-group",style:{display:"flex",flexDirection:"row",marginRight:"6px",borderRight:"1px solid #ddd",paddingRight:"6px"}}),B=DomUtils.h.createDiv({id:"scroll-group",cls:"gs-nav-group",style:{display:"flex",borderRight:"1px solid #ddd",marginRight:"6px",paddingRight:"6px",flexDirection:"row"}}),U=DomUtils.h.createDiv({cls:"gs-nav-group",id:"message-tools-group",style:{display:"flex",flexDirection:"row",marginRight:"0"}}),n&&(e=R(p.foldMessages,g.foldMessages,e=>(e.preventDefault(),u&&u(),!1),"Fold All Messages"),t=R(p.unfoldMessages,g.unfoldMessages,e=>(e.preventDefault(),f&&f(),!1),"Unfold All Messages"),w.appendChild(e),w.appendChild(t),T.appendChild(w)),d&&(e=R(p.foldCode,g.foldCode,e=>(e.preventDefault(),h&&h(),!1),"Fold All Code"),t=R(p.unfoldCode,g.unfoldCode,e=>(e.preventDefault(),x&&x(),!1),"Unfold All Code"),D.appendChild(e),D.appendChild(t),T.appendChild(D)),i&&(e=R(p.scrollTop,g.scrollTop,e=>(e.preventDefault(),m?m():ScrollUtils.scrollToElement(o,0),!1),"Scroll to Top"),t=R(p.scrollBottom,g.scrollBottom,e=>(e.preventDefault(),y?y():ScrollUtils.scrollToBottom(),!1),"Scroll to Bottom"),B.appendChild(e),B.appendChild(t),T.appendChild(B)),e=R(p.messageTools||"MT",g.messageTools||"Messages Tool",e=>(e.preventDefault(),C&&C(),!1),"Open Messages Tool"),U.appendChild(e),T.appendChild(U),a&&(t=(b=new MessagePositionIndicator(c)).initialize(o),T.appendChild(t),b.hide()),o.appendChild(T),A(),T;throw new Error("No container provided for ConversationControlPanel")},update:function(e={}){if(Object.assign(t,e),e.buttonWidth){let o=e.buttonWidth||r;M.forEach(e=>{e.style.width=v?o+"px":null}),v&&(T.style.maxWidth=o+24+"px")}if(e.buttonLabels||e.fullButtonLabels){let t={...p,...e.buttonLabels||{}},l={...g,...e.fullButtonLabels||{}};M.forEach(e=>{var o=e.title;"Fold All Messages"===o?(e.dataset.shortText=t.foldMessages,e.dataset.fullText=l.foldMessages):"Unfold All Messages"===o?(e.dataset.shortText=t.unfoldMessages,e.dataset.fullText=l.unfoldMessages):"Fold All Code"===o?(e.dataset.shortText=t.foldCode,e.dataset.fullText=l.foldCode):"Unfold All Code"===o?(e.dataset.shortText=t.unfoldCode,e.dataset.fullText=l.unfoldCode):"Scroll to Top"===o?(e.dataset.shortText=t.scrollTop,e.dataset.fullText=l.scrollTop):"Scroll to Bottom"===o?(e.dataset.shortText=t.scrollBottom,e.dataset.fullText=l.scrollBottom):"Open Messages Tool"===o&&(e.dataset.shortText=t.messageTools||"MT",e.dataset.fullText=l.messageTools||"Messages Tool"),e.textContent=v?e.dataset.shortText:e.dataset.fullText})}var o;e.positionIndicatorOptions&&b&&b.update(e.positionIndicatorOptions),void 0!==e.showMessagePosition&&e.showMessagePosition!==a&&(e.showMessagePosition&&!b?(o=(b=new MessagePositionIndicator(e.positionIndicatorOptions||c)).initialize(T.parentNode),T.appendChild(o),b.updateDockingState(v)):!e.showMessagePosition&&b&&(b.cleanup(),b=null))},refreshPositionIndicator:function(){b&&b.refresh()},cleanup:function(){b&&(b.cleanup(),b=null),window.removeEventListener("scroll",A),T&&T.parentNode&&T.parentNode.removeChild(T)}}}module.exports=ConversationControlPanel;
