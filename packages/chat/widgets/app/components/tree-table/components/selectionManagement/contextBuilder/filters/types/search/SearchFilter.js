/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

class SearchFilter{constructor({container:t,onFilterChange:e,onSearchExecute:i}){t?(this.container=t,this.onFilterChange=e,this.onSearchExecute=i,this.searchInput=null,this.clearSearchButton=null,this.spinnerElement=null,this.spinnerInterval=null,this.isSearchLoading=!1,this.isDisabled=!1,this.matchingItemIds=null,this.render(),this.addEventListeners()):console.error("SearchFilter: Container element is required.")}render(){this.container.querySelector(".search-input-wrapper")||(this.container.innerHTML=`
                 <div class="search-input-wrapper">
                     <input type="text" class="context-builder-search-input" placeholder="Search and filter by file content (terms, symbols, etc.).">
                     <button class="clear-search-button">X</button>
                     <div class="search-spinner-container" style="display: none;">
                         <!-- Spinner SVG will be inserted here -->
                     </div>
                 </div>
                 <!-- Filter Statistics will be appended here by ContextBuilderModal -->
             `),this.searchInput=this.container.querySelector(".context-builder-search-input"),this.clearSearchButton=this.container.querySelector(".clear-search-button"),this.spinnerContainer=this.container.querySelector(".search-spinner-container"),this.spinnerContainer&&(this.spinnerContainer.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" style="cursor: pointer;"><path fill-rule="evenodd" d="M8 2.5a5.487 5.487 0 00-4.131 1.869l1.204 1.204A.25.25 0 014.896 6H1.25A.25.25 0 011 5.75V2.104a.25.25 0 01.427-.177l1.38 1.38A7.001 7.001 0 0114.95 7.16a.75.75 0 11-1.49.178A5.501 5.501 0 008 2.5zM1.705 8.005a.75.75 0 01.834.656 5.501 5.501 0 009.592 2.97l-1.204-1.204a.25.25 0 01.177-.427h3.646a.25.25 0 01.25.25v3.646a.25.25 0 01-.427.177l-1.38-1.38A7.001 7.001 0 011.05 8.84a.75.75 0 01.656-.834z"></path></svg>',this.spinnerElement=this.spinnerContainer.querySelector("svg")),this.clearSearchButton&&(this.clearSearchButton.style.visibility="hidden",this.clearSearchButton.style.pointerEvents="none")}addEventListeners(){this.searchInput&&(this.searchInput.addEventListener("input",this.handleSearchInput.bind(this)),this.searchInput.addEventListener("keydown",this.handleSearchInputKeydown.bind(this))),this.clearSearchButton&&this.clearSearchButton.addEventListener("click",this.handleClearSearchClick.bind(this))}handleSearchInput(){this.searchInput&&this.clearSearchButton&&!this.isSearchLoading&&!this.isDisabled&&(0<this.searchInput.value.length?(this.clearSearchButton.style.visibility="visible",this.clearSearchButton.style.pointerEvents="auto",this.spinnerContainer&&(this.spinnerContainer.style.display="none")):(this.clearSearchButton.style.visibility="hidden",this.clearSearchButton.style.pointerEvents="none"))}handleSearchInputKeydown(t){"Enter"!==t.key||this.isSearchLoading||this.isDisabled||(t.preventDefault(),t.stopPropagation(),t=this.searchInput.value.trim(),this.onSearchExecute&&this.onSearchExecute(t))}handleClearSearchClick(){!this.searchInput||this.isSearchLoading||this.isDisabled||(this.searchInput.value="",this.searchInput.dispatchEvent(new Event("input")),this.matchingItemIds=null,this.onFilterChange(this.getState()))}getState(){return{searchTerm:this.searchInput?this.searchInput.value.trim():"",matchingItemIds:this.matchingItemIds}}applyState(t){this.searchInput&&""===t.searchTerm&&(this.searchInput.value="",this.handleSearchInput()),t.hasOwnProperty("matchingItemIds")&&(this.matchingItemIds=t.matchingItemIds)}setDisabled(t){this.isDisabled=t,this.searchInput&&(this.searchInput.disabled=t||this.isSearchLoading),t?(this.clearSearchButton&&(this.clearSearchButton.style.visibility="hidden",this.clearSearchButton.style.pointerEvents="none"),this.spinnerContainer&&(this.spinnerContainer.style.display="none",this.stopSpinnerAnimation())):this.setSearchInProgress(this.isSearchLoading)}setMatchingItemIds(t){this.matchingItemIds=t}setSearchInProgress(t){this.isSearchLoading=t,this.searchInput&&(this.searchInput.disabled=this.isDisabled||t),t?(this.clearSearchButton&&(this.clearSearchButton.style.visibility="hidden",this.clearSearchButton.style.pointerEvents="none"),this.spinnerContainer&&(this.spinnerContainer.style.display="flex",this.startSpinnerAnimation())):(this.spinnerContainer&&(this.spinnerContainer.style.display="none",this.stopSpinnerAnimation()),this.isDisabled||(this.searchInput&&0<this.searchInput.value.length?(this.clearSearchButton.style.visibility="visible",this.clearSearchButton.style.pointerEvents="auto"):(this.clearSearchButton.style.visibility="hidden",this.clearSearchButton.style.pointerEvents="none")))}startSpinnerAnimation(){this.spinnerElement&&!this.spinnerInterval&&this.spinnerElement.classList.add("spinning")}stopSpinnerAnimation(){this.spinnerElement&&this.spinnerElement.classList.remove("spinning")}reset(){this.searchInput&&(this.searchInput.value="",this.searchInput.dispatchEvent(new Event("input"))),this.matchingItemIds=null,this.setSearchInProgress(!1),this.setDisabled(!1)}}module.exports={SearchFilter:SearchFilter};
