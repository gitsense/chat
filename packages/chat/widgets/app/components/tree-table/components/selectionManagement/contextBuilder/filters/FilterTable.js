/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

class FilterTable{constructor({container:e,data:t,nameColumnHeader:i,sortColumn:s,sortDirection:l,onSelectionChange:a,initialSelectedIds:n=[],inputPlaceholder:h}){this.container=e,this.onSelectionChange=a,this.nameColumnHeader=i,this.sortColumn=s||null,this.sortDirection=l||"asc",this.disabled=!1,this.expandIcon=null,this.filterInput=null,this.filterText="",this.inputPlaceholder=h,this.minFilterLength=2,this.displayMode="all",this.data=t,this.selectedIds=new Set(n),this.table=document.createElement("table"),this.table.className="filter-table",this.table.style.tableLayout="fixed",this.thead=null,this.tbody=null,this.showAllButton=null,this.showSelectedButton=null,this.resetButton=null,this.debounceTimer=null,this.itemRowMap=new Map,this.selectionModal=null,this.container.appendChild(this.table),this.render()}render(){this.table.innerHTML="",this.itemRowMap.clear(),this.filterText="",this.createTableHeader(),this.createTableBody(),this.renderRows()}createTableHeader(){this.thead=this.table.createTHead();var e=this.thead.insertRow(),t=document.createElement("th"),i=(t.className="col-checkbox",document.createElement("input")),i=(i.type="checkbox",i.id="filter-table-select-all",i.addEventListener("change",e=>{this.handleSelectAllChange(e.target.checked)}),t.appendChild(i),e.appendChild(t),document.createElement("th")),t=(i.className="col-name",i.textContent=this.nameColumnHeader,i.style.cursor="pointer",i.addEventListener("click",()=>this.handleSortClick("name")),e.appendChild(i),document.createElement("th"));t.className="col-items",t.textContent="",t.style.cursor="pointer",t.addEventListener("click",()=>this.handleSortClick("count")),e.appendChild(t),this.updateSelectAllCheckboxState();i=this.thead.insertRow().insertCell();i.colSpan=3,i.style.padding="0",i.style.alignItems="center",this.expandIcon=this.createExpandIcon(),this.filterInput=document.createElement("input"),this.filterInput.type="text",this.filterInput.placeholder="Search options...",this.filterInput.className="filter-table-input",this.filterInput.style.width="calc(100% - 40px)",this.filterInput.style.boxSizing="border-box",this.filterInput.style.padding="8px",this.filterInput.addEventListener("keyup",this.handleFilterInput.bind(this)),i.appendChild(this.filterInput),i.appendChild(this.expandIcon)}createExpandIcon(){var e=document.createElement("div");return e.className="filter-table-expand-icon",e.style.cursor="pointer",e.style.padding="8px",e.style.display="inline-block",e.innerHTML=`
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="13px" height="13px">
                <path d="M6.137 8.803a.749.749 0 1 1 1.06 1.06L3.811 13.25H6a.75.75 0 0 1 0 1.5H2a.75.75 0 0 1-.75-.75v-4a.75.75  0 0 1 1.5 0v2.19l3.387-3.387ZM14.75 6a.75.75 0 0 1-1.5 0V3.811L9.863 7.197a.749.749 0 1 1-1.06-1.06L12.19 2.75H10a.75.75 0 0 1 0-1.5h4a.75.75 0 0 1 .75.75v4Z"></path>
            </svg>
        `,e.addEventListener("click",this.handleExpandIconClick.bind(this)),e}handleExpandIconClick(){var e=require("../SelectionModal").createSelectionModal;this.selectionModal||(this.selectionModal=e({onSaveSelections:this.handleModalSelectionSave.bind(this)})),this.selectionModal&&"function"==typeof this.selectionModal.show&&this.selectionModal.show(this.data,this.selectedIds,`Select ${this.nameColumnHeader}s`)}handleModalSelectionSave(e){this.selectedIds=new Set(e),this.itemRowMap.forEach((e,t)=>{e=e.querySelector('input[type="checkbox"]');e&&(e.checked=this.selectedIds.has(t))}),this.updateSelectAllCheckboxState(),this.notifySelectionChange(),this.selectionModal&&"function"==typeof this.selectionModal.hide&&this.selectionModal.hide()}createTableBody(){this.tbody=this.table.createTBody()}renderRows(){var e,t;this.tbody&&(this.tbody.innerHTML="",this.itemRowMap.clear(),e=[...this.data],this.sortColumn&&e.sort((e,t)=>{e=e[this.sortColumn],t=t[this.sortColumn];return e<t?"asc"===this.sortDirection?-1:1:t<e?"asc"===this.sortDirection?1:-1:0}),0===(e=e.filter(e=>{var t;return!this.filterText||this.filterText.length<this.minFilterLength||(t=this.filterText.toLowerCase(),e.name.toLowerCase().includes(t))}).filter(e=>"selected"!==this.displayMode||this.selectedIds.has(e.id))).length?((t=this.tbody.insertRow().insertCell()).colSpan=3,t.textContent=`No ${this.nameColumnHeader.toLowerCase()}s found.`,t.style.textAlign="center",t.style.fontStyle="italic"):e.forEach(t=>{var e=this.tbody.insertRow(),i=(e.dataset.id=t.id,this.itemRowMap.set(t.id,e),e.insertCell());let s=document.createElement("input");s.type="checkbox",s.checked=this.selectedIds.has(t.id),s.addEventListener("change",e=>{this.handleItemSelectionChange(t.id,e.target.checked)}),s.disabled=this.disabled,i.style.textOverflow="inherit",i.style.padding="12px",i.appendChild(s);var i=e.insertCell(),l=document.createElement("a"),i=(l.href="#",l.textContent=t.name,l.title=t.name,l.style.color="black",l.addEventListener("click",e=>{e.preventDefault(),s.checked=!s.checked;e=new Event("change");s.dispatchEvent(e)}),i.style.padding="12px",i.style.paddingLeft="5px",i.appendChild(l),e.insertCell());i.textContent=t.count,i.style.textAlign="right",i.style.padding="12px"}))}handleItemSelectionChange(e,t){t?this.selectedIds.add(e):this.selectedIds.delete(e),this.updateSelectAllCheckboxState(),this.notifySelectionChange()}handleSelectAllChange(i){this.selectedIds.clear(),i&&this.data.forEach(e=>this.selectedIds.add(e.id)),this.itemRowMap.forEach((e,t)=>{e=e.querySelector('input[type="checkbox"]');e&&(e.checked=i)}),this.notifySelectionChange()}handleSortClick(e){this.sortColumn===e?this.sortDirection="asc"===this.sortDirection?"desc":"asc":(this.sortColumn=e,this.sortDirection="asc"),this.renderRows()}handleFilterInput(){var e=this.filterInput.value.trim();this.filterText!==e&&(this.filterText=e,this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.renderRows()},50))}handleShowAllClick(){"all"!==this.displayMode&&(this.displayMode="all",this.updateDisplayButtonStyles(),this.renderRows())}handleShowSelectedClick(){"selected"!==this.displayMode&&(this.displayMode="selected",this.updateDisplayButtonStyles(),this.renderRows())}updateSelectAllCheckboxState(){var e,t,i=this.thead.querySelector("#filter-table-select-all");i&&(e=this.data.length,t=this.selectedIds.size,i.checked=0<e&&e===t,i.disabled=0===e)}notifySelectionChange(){"function"==typeof this.onSelectionChange&&this.onSelectionChange(Array.from(this.selectedIds))}updateData(e){this.data=e,this.filterText="",this.displayMode="all",this.selectedIds.clear(),this.render()}setSelectedIds(e){this.selectedIds=new Set(e),this.itemRowMap.forEach((e,t)=>{e=e.querySelector('input[type="checkbox"]');e&&(e.checked=this.selectedIds.has(t))}),this.updateSelectAllCheckboxState()}getSelectedIds(){return Array.from(this.selectedIds)}clearSelections(){this.selectedIds.clear(),this.itemRowMap.forEach(e=>{e=e.querySelector('input[type="checkbox"]');e&&(e.checked=!1)}),this.updateSelectAllCheckboxState(),this.notifySelectionChange()}reset(){this.clearSelections()}setDisabled(t){this.disabled=t,this.itemRowMap.forEach(e=>{e=e.querySelector('input[type="checkbox"]');e&&(e.disabled=t)});var e=this.thead.querySelector("#filter-table-select-all");e&&(e.disabled=t||0===this.data.length),this.filterInput&&(this.filterInput.disabled=t),this.resetButton&&(this.resetButton.disabled=t),this.updateDisplayButtonStyles(),t?this.table.classList.add("disabled"):this.table.classList.remove("disabled")}updateDisplayButtonStyles(){var e="gray";this.showAllButton&&(this.showAllButton.classList.toggle("active","all"===this.displayMode&&!this.showAllButton.disabled),this.showAllButton.style.color="all"!==this.displayMode||this.showAllButton.disabled?e:""),this.showSelectedButton&&(this.showSelectedButton.classList.toggle("active","selected"===this.displayMode&&!this.showSelectedButton.disabled),this.showSelectedButton.style.color="selected"!==this.displayMode||this.showSelectedButton.disabled?e:""),this.resetButton&&(this.resetButton.style.color=this.resetButton.disabled?e:"")}}module.exports={FilterTable:FilterTable};
