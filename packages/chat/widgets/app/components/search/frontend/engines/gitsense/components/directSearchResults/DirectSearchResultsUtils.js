/*
 * GitSense Chat - Minified Distribution File
 *
 * This JavaScript file is part of the minified distribution of GitSense Chat.
 * It has been optimized (minified) for performance and efficient delivery.
 *
 * This software is permitted for internal use and modification.
 * Copying for profit or redistribution is strictly not permitted.
 *
 * The Fair License, which formalizes these terms, will be adopted as the official license in the future.
 * Once finalized, the unminified source code will be freely available for internal use for non-
 * commercial purposes.
 *
 * This software may not be used to develop or enhance any product or service that competes
 * directly or indirectly with GitSense Chat without explicit permission.
 *
 * Copyright (c) 2025 GitSense. All rights reserved.
 */

let GSToolBlockUtils=require("@gitsense/gsc-utils").GSToolBlockUtils,SEARCH_TOOL=require("../../../../constants").SEARCH_TOOL,MESSAGE_TYPE_DIRECT_SEARCH_RESULTS="direct-search-results",MESSAGE_TYPE_DIRECT_SEARCH_ERROR="direct-search-error",CSS_CLASSES={CONTAINER:"gitsense-dsr-container",HEADER:"gitsense-dsr-header",QUERY_BLOCK:"gitsense-dsr-query-block",LINK_BUTTON:"gitsense-dsr-link-button",BUTTON:"gitsense-dsr-button",VISIBILITY_NOTICE:"gitsense-dsr-visibility-notice",PAGINATION:"gitsense-dsr-pagination",TABLE:"gitsense-dsr-table",TABLE_HEADER:"gitsense-dsr-table-header",TABLE_ROW:"gitsense-dsr-table-row",SNIPPET_ITEM:"gitsense-dsr-snippet-item",SNIPPET_CONTENT:"gitsense-dsr-snippet-content",VIEW_ALL_DETAILS:"gitsense-dsr-view-details",COLLAPSIBLE_CONTENT:"gitsense-dsr-collapsible-content",COLLAPSIBLE_HEADER:"gitsense-dsr-collapsible-header",COLLAPSIBLE_ICON:"gitsense-dsr-collapsible-icon"};function formatDate(t){if(!t)return"N/A";try{return new Date(t).toLocaleString()}catch(e){return console.warn("formatDate: Invalid timestamp",t,e),"Invalid Date"}}function parseRawJsonFromMessage(e){e=e.match(/```json\n([\s\S]*?)\n```/);if(e&&e[1])try{return JSON.parse(e[1])}catch(e){console.error("parseRawJsonFromMessage: Failed to parse raw JSON results:",e)}return null}function formatChatPathLink(e,t,s){var a,n;return e&&t?(a=(e=e.split(" > ")).pop(),e=e.join(" > "),n=s.createDiv({style:{display:"flex",alignItems:"baseline"}}),e&&n.appendChild(s.createSpan({text:e+" > ",style:{fontSize:"0.8em",color:"#666",marginRight:"3px"}})),n.appendChild(s.createLink({text:a,href:"/?chat="+t,cls:CSS_CLASSES.LINK_BUTTON,style:{fontWeight:"bold",textDecoration:"none",color:"#007bff"}})),n):s.createSpan({text:"N/A"})}function getItemName(e){switch(e.source_type){case"chat":return e.chats_name||"Untitled Chat";case"message":return e.messages_meta_file_name||"Message ID: "+e.messages_id;case"code-block":return e.code_blocks_component||e.code_blocks_meta_file_name||"Code Block UUID: "+e.code_blocks_uuid;default:return"Unknown Item"}}function getMetadataSummary(e){var t=[];switch(e.source_type){case"chat":e.chats_type&&t.push("Type: "+e.chats_type),e.chats_owner&&t.push("Owner: "+e.chats_owner);break;case"message":e.messages_role&&t.push("Role: "+e.messages_role),e.messages_type&&t.push("Type: "+e.messages_type),e.messages_meta_file_extension&&t.push("Ext: "+e.messages_meta_file_extension);break;case"code-block":e.code_blocks_component&&t.push("Component: "+e.code_blocks_component),e.code_blocks_header?.Language&&t.push("Lang: "+e.code_blocks_header.Language),void 0!==e.code_blocks_size&&t.push(`Size: ${e.code_blocks_size} bytes`)}return 0<t.length?t.join(" | "):"No additional info."}function formatSearchCriteriaOptions(e){var t=[];let s=e.scope||"N/A";switch(e.scope){case"current-chat":s="Current Chat";break;case"current-chat-and-branches":s="Chats ↓";break;case"connected-chats":s="Chats ↕";break;case"all-chats":s="All Chats"}t.push("<b>Scope:</b> "+s);var a=e.targets||[],a=0<a.length?a.map(e=>{switch(e){case"chats":return"Chats";case"messages":return"Messages";case"code-blocks":return"Code Blocks";default:return e}}).join(", "):"None",a=(t.push("<b>Targets:</b> "+a),e.options||{}),e=[];return a.caseSensitive&&e.push("Case Sensitive"),a.regex&&e.push("Use Regex"),t.push("<b>Options:</b> "+(0<e.length?e.join(", "):"None")),t.join(" &nbsp; &nbsp; ")}function createSearchToolBlock(e,t,s=0,a){e={...e,pagination:{...e.pagination,offset:s}},s={tool:SEARCH_TOOL,config:{layout:"default",engine:"gitsense",data:{searchCriteria:e},states:[{type:"direct-search",created_at:(new Date).toISOString(),finished_at:null}]}};return GSToolBlockUtils.formatToolBlock(s)}module.exports={MESSAGE_TYPE_DIRECT_SEARCH_RESULTS:MESSAGE_TYPE_DIRECT_SEARCH_RESULTS,MESSAGE_TYPE_DIRECT_SEARCH_ERROR:MESSAGE_TYPE_DIRECT_SEARCH_ERROR,CSS_CLASSES:CSS_CLASSES,formatDate:formatDate,parseRawJsonFromMessage:parseRawJsonFromMessage,formatChatPathLink:formatChatPathLink,getItemName:getItemName,getMetadataSummary:getMetadataSummary,formatSearchCriteriaOptions:formatSearchCriteriaOptions,createSearchToolBlock:createSearchToolBlock};
